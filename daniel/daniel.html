<!-- 
    To serve this page locally with Python 3 HTTP server, run:
    python3 -m http.server 8080 --bind 127.0.0.1 in newbie_hackathon_group2
    Then open: http://127.0.0.1:8080/emily.html
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Daniel's Page</title>
    <link rel="stylesheet" href="daniel.css" />
  </head>
  <body>
    <h1>Daniel</h1>

    <section class="container">
      <div class="slider-wrapper">
        <div class="slider" id="gallery">
          <img id="piano" src="./images/Piano.jpg" alt="Piano">
          <img id="marching_band" src="./images/MarchingBand.jpg" alt="Marching Band">
          <img id="octet" src="./images/Octet.jpg" alt="Octet">
        </div>

        <div class="slider-nav" id="dots">
          <a href="#piano"></a>
          <a href="#marching_band"></a>
          <a href="#octet"></a>
        </div>
      </div>
    </section>

    <section class="video-container">
      <video controls>
        <source src="./images/piano_recital.MP4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    </section>

    <section class="video-container">
      <iframe src="https://www.youtube.com/embed/EdQCYR10Vbg?si=74AfYT90Cttwml7q" 
        title="YouTube video player" 
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
        referrerpolicy="strict-origin-when-cross-origin" 
        allowfullscreen>
      </iframe>
    </section>

    <script>
      const slider = document.getElementById('gallery');
      const dots   = document.getElementById('dots');

      // ---- ghost slides (yours) ----
      const originals = Array.from(slider.children);
      const firstReal = originals[0].cloneNode(true);
      const lastReal  = originals[originals.length - 1].cloneNode(true);
      firstReal.removeAttribute('id');
      lastReal.removeAttribute('id');
      firstReal.classList.add('ghost');
      lastReal.classList.add('ghost');
      slider.insertBefore(lastReal, slider.firstChild);
      slider.appendChild(firstReal);

      // Width of one slide; recompute on resize
      const slideW = () => slider.clientWidth;
      const slideCount = originals.length;

      // Start at first real slide (index 1 counting the leading ghost)
      function setNoSnapJump(leftPx) {
        const prevSnap = slider.style.scrollSnapType;
        const prevBeh  = slider.style.scrollBehavior;
        slider.style.scrollSnapType = 'none';
        slider.style.scrollBehavior = 'auto';
        slider.scrollLeft = leftPx;
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            slider.style.scrollSnapType = prevSnap || 'x mandatory';
            slider.style.scrollBehavior = prevBeh  || 'smooth';
            if (typeof after === 'function') after();
          });
        });
      }
      setNoSnapJump(slideW()); // go to first real slide

      // Stable index calc that tolerates fractional pixels
      function currentIndex() {
        const w = slideW();
        return Math.floor((slider.scrollLeft + w / 2) / w);
      }

      // Debounced wrap logic with a guard that lasts through snap restore
      let wrapGuard = false;
      let t;
      slider.addEventListener('scroll', () => {
        if (wrapGuard) return;
        clearTimeout(t);
        t = setTimeout(() => {
          const idx = currentIndex();
          const totalWithGhosts = slideCount + 2;

          if (idx === totalWithGhosts - 1) {
            // trailing ghost -> jump to first real
            wrapGuard = true;
            setNoSnapJump(slideW() * 1);
            setTimeout(() => (wrapGuard = false), 180); // give snap time to settle
          } else if (idx === 0) {
            // leading ghost -> jump to last real
            wrapGuard = true;
            setNoSnapJump(slideW() * slideCount);
            setTimeout(() => (wrapGuard = false), 180);
          }
          updateDots();
        }, 100); // slightly longer debounce reduces edge flicker
      }, { passive: true });

      // Dots
      function goToReal(i) {
        slider.scrollTo({ left: slideW() * (i + 1), behavior: 'smooth' });
      }
      function updateDots() {
        const idx = currentIndex();
        let real = idx - 1;
        if (real < 0) real = slideCount - 1;
        if (real >= slideCount) real = 0;
        [...dots.children].forEach((a, i) => {
          a.style.opacity = i === real ? '1' : '0.5';
        });
      }
      dots?.addEventListener('click', (e) => {
        if (e.target.tagName !== 'A') return;
        e.preventDefault();
        const i = [...dots.children].indexOf(e.target);
        if (i >= 0) goToReal(i);
      });

      // Keep position on resize
      window.addEventListener('resize', () => {
        const real = Math.max(0, Math.min(slideCount - 1, currentIndex() - 1));
        setNoSnapJump(slideW() * (real + 1));
        updateDots();
      });

      // Add drag scrolling functionality
      let isMouseDown = false;
      let startX;
      let scrollLeft;

      slider.addEventListener('mousedown', (e) => {
        isMouseDown = true;
        slider.style.cursor = 'grabbing';
        startX = e.pageX - slider.offsetLeft;
        scrollLeft = slider.scrollLeft;
      });

      slider.addEventListener('mouseleave', () => {
        isMouseDown = false;
        slider.style.cursor = 'grab';
      });

      slider.addEventListener('mouseup', () => {
        isMouseDown = false;
        slider.style.cursor = 'grab';
      });

      slider.addEventListener('mousemove', (e) => {
        if (!isMouseDown) return;
        e.preventDefault();
        const x = e.pageX - slider.offsetLeft;
        const walk = (x - startX) * 2;
        slider.scrollLeft = scrollLeft - walk;
      });

      // Add touch events for mobile
      slider.addEventListener('touchstart', (e) => {
        isMouseDown = true;
        startX = e.touches[0].pageX - slider.offsetLeft;
        scrollLeft = slider.scrollLeft;
      });

      slider.addEventListener('touchend', () => {
        isMouseDown = false;
      });

      slider.addEventListener('touchmove', (e) => {
        if (!isMouseDown) return;
        e.preventDefault();
        const x = e.touches[0].pageX - slider.offsetLeft;
        const walk = (x - startX) * 2;
        slider.scrollLeft = scrollLeft - walk;
      });

      // Set initial cursor style
      slider.style.cursor = 'grab';

      updateDots();
    </script>

  </body>


  <footer>
    <button onclick="location.href='../home/index.html'">
      Back to Home Page
    </button>
  </footer>
</html>